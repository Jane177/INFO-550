---
title: "INFO 550 HW2--Yajie Liu"
output: html_document
---
# First input the data
I get the current working directory, load the WGCNA package and load the data. 
Then take a look at the what is in the data set.
```{r}
getwd();
workingDir = ".";
library("WGCNA");
options(stringsAsFactors = FALSE);
acmc = read.csv("ALL COVID vs MIS-C.csv");
dim(acmc);
colnames(acmc)<-substring(colnames(acmc),1,7);
```
## Data cleanning
Since the data is not well organized, I then make the data in datafram fromat and
transpose it.
```{r}
datExpr0 = as.data.frame(t(acmc));
```
Check that all genes and samples have sufficiently low numbers of missing values.
Remove the samples with high proportion of missing values. Removed sample names 
are printed.
```{r}
gsg = goodSamplesGenes(datExpr0, verbose = 3);
gsg$allOK
if (!gsg$allOK)
{
  if (sum(!gsg$goodGenes)>0) 
     printFlush(paste("Removing genes:", paste(names(datExpr0)[!gsg$goodGenes], collapse = ", ")));
  if (sum(!gsg$goodSamples)>0) 
     printFlush(paste("Removing samples:", paste(rownames(datExpr0)[!gsg$goodSamples], collapse = ", ")));
  datExpr0 = datExpr0[gsg$goodSamples, gsg$goodGenes]
}
```
## Plot sample tree, we used cluster under the line.
```{r}
sampleTree = hclust(dist(datExpr0), method = "complete");
sizeGrWindow(12,9)
par(cex = 0.6);
par(mar = c(0,4,2,0))
plot(sampleTree, main = "Sample clustering to detect outliers", sub="", xlab="", cex.lab = 1.5, 
     cex.axis = 1.5, cex.main = 2)
table(sampleTree)

bline(h = 15, col = "red");
clust = cutreeStatic(sampleTree, cutHeight = 15, minSize = 10)
table(clust)
keepSamples = (clust==1)
datExpr = datExpr0[keepSamples, ]
nGenes = ncol(datExpr)
nSamples = nrow(datExpr)
datExpr = datExpr0
```
## Verify the data structure
Re-cluster samples
Plot the sample dendrogram and the colors underneath.
```{r}
design_color <-c(rep(0,length(ncol(design))))
design_color[design[,1] == 1]<-1
design_color[design[,2] == 1]<-2
design_color[design[,3] == 1]<-3
design_color[design[,4] == 1]<-4
names(design_color)<-rownames(design)
sampleTree2 = hclust(dist(datExpr), method = "ward.D")

traitColors = numbers2colors(design,signed = FALSE);
plotDendroAndColors(sampleTree2, traitColors,
                    groupLabels = colnames(design), 
                    main = "Sample dendrogram and trait heatmap")
```
## Save the data in a .RData file
```{r}
save(datExpr, design, file = "FemaleLiver-01-dataInput.RData")
```
